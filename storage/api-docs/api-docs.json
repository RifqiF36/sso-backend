{
    "openapi": "3.0.0",
    "info": {
        "title": "SSO Mitra â€¢ Identity Provider & OAuth2 Authorization Server",
        "description": "Layanan SSO Mitra menggunakan Laravel Sanctum untuk autentikasi dan OAuth2 Authorization Code Grant untuk SSO integration dengan aplikasi klien (SIPRIMA, dsb).",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://127.0.0.1:8000",
            "description": "Production SSO Mitra Server"
        }
    ],
    "paths": {
        "/api/v2/auth/me": {
            "get": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Get authenticated user profile with menu",
                "description": "Get authenticated user profile\n* @OA\\Get(\npath=\"/api/v2/auth/me\",\noperationId=\"AuthV2Me\",\ntags={\"Auth V2\"},\nsummary=\"Get authenticated user profile with menu\",\nsecurity={{\"BearerAuth\":{}}},",
                "operationId": "AuthV2Me",
                "responses": {
                    "200": {
                        "description": "Success",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "data": {
                                            "properties": {
                                                "user": {
                                                    "type": "object"
                                                },
                                                "menu": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "object"
                                                    }
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v2/auth/user/{id}": {
            "get": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Get user by ID",
                "description": "Get user by ID",
                "operationId": "AuthV2GetUserById",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "User ID",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "example": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Success",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "data": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "User not found"
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v2/auth/login": {
            "post": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Login user",
                "description": "Authenticate user with email and password.",
                "operationId": "AuthV2Login",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "john.doe@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "Password123"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Login successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Login successful"
                                        },
                                        "data": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Invalid credentials"
                    },
                    "403": {
                        "description": "Email not verified"
                    }
                }
            }
        },
        "/api/v2/auth/register": {
            "post": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Register new user account",
                "description": "Create a new user account and send OTP verification email",
                "operationId": "AuthV2Register",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "name",
                                    "email",
                                    "password",
                                    "password_confirmation"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "John Doe"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "john.doe@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "minLength": 8,
                                        "example": "Password123"
                                    },
                                    "password_confirmation": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "Password123"
                                    },
                                    "nip": {
                                        "type": "string",
                                        "example": "199001012020011001",
                                        "nullable": true
                                    },
                                    "phone": {
                                        "type": "string",
                                        "example": "081234567890",
                                        "nullable": true
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Registration successful",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Registration successful. Please check your email for verification code."
                                        },
                                        "data": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/v2/auth/verify": {
            "post": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Verify email with OTP",
                "description": "Verify user email address using OTP code sent during registration",
                "operationId": "AuthV2Verify",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "otp"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "john.doe@example.com"
                                    },
                                    "otp": {
                                        "type": "string",
                                        "example": "123456"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Email verified successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Email verified successfully"
                                        },
                                        "data": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid or expired OTP"
                    },
                    "404": {
                        "description": "User not found"
                    }
                }
            }
        },
        "/api/v2/auth/logout": {
            "post": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Logout user",
                "description": "Revoke all user tokens and logout",
                "operationId": "AuthV2Logout",
                "responses": {
                    "200": {
                        "description": "Logged out successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Logged out successfully"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v2/auth/reset-password": {
            "post": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Request password reset",
                "description": "Send OTP code to user email for password reset",
                "operationId": "AuthV2ResetPassword",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "john.doe@example.com"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OTP sent successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Password reset code has been sent to your email"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "User not found"
                    }
                }
            }
        },
        "/api/v2/auth/confirm-reset-password": {
            "post": {
                "tags": [
                    "Auth V2"
                ],
                "summary": "Confirm password reset with OTP",
                "description": "Reset user password using OTP code and new password",
                "operationId": "AuthV2ConfirmResetPassword",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "otp",
                                    "password",
                                    "password_confirmation"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "john.doe@example.com"
                                    },
                                    "otp": {
                                        "type": "string",
                                        "example": "123456"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "minLength": 8,
                                        "example": "NewPassword123"
                                    },
                                    "password_confirmation": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "NewPassword123"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Password reset successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Password reset successfully"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid or expired OTP"
                    },
                    "404": {
                        "description": "User not found"
                    }
                }
            }
        },
        "/api/v1/apps": {
            "get": {
                "tags": [
                    "App Picker"
                ],
                "summary": "Daftar aplikasi yang boleh diakses oleh user",
                "operationId": "SsoMitraAppPicker",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": [
                                    {
                                        "code": "asset",
                                        "name": "Asset Management",
                                        "url": "http://127.0.0.1:8000",
                                        "icon": "https://example.com/icons/asset.png"
                                    }
                                ]
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/login": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Login user (Sanctum Token)",
                "operationId": "SsoMitraLogin",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "example": "admin_kota@sso"
                                    },
                                    "password": {
                                        "type": "string",
                                        "example": "AdminKota@123"
                                    }
                                },
                                "type": "object"
                            },
                            "example": {
                                "email": "admin_kota@sso",
                                "password": "AdminKota@123"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Berhasil login",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "token": {
                                            "type": "string"
                                        },
                                        "user": {
                                            "properties": {
                                                "id": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "name": {
                                                    "type": "string",
                                                    "example": "Admin Kota"
                                                },
                                                "email": {
                                                    "type": "string",
                                                    "example": "admin_kota@sso"
                                                },
                                                "roles": {
                                                    "type": "array",
                                                    "items": {
                                                        "properties": {
                                                            "role": {
                                                                "type": "string",
                                                                "example": "admin_kota"
                                                            },
                                                            "module": {
                                                                "type": "string",
                                                                "example": "asset_risk"
                                                            },
                                                            "tenant_id": {
                                                                "type": "integer",
                                                                "example": 1
                                                            },
                                                            "granted_at": {
                                                                "type": "string",
                                                                "example": "2025-11-15 00:00:00"
                                                            },
                                                            "expires_at": {
                                                                "type": "string",
                                                                "example": null
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                },
                                                "tenants": {
                                                    "type": "array",
                                                    "items": {
                                                        "properties": {
                                                            "tenant_id": {
                                                                "type": "integer",
                                                                "example": 1
                                                            },
                                                            "nama": {
                                                                "type": "string",
                                                                "example": "Diskominfo Kota"
                                                            },
                                                            "kode": {
                                                                "type": "string",
                                                                "example": "diskominfo"
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                },
                                                "apps": {
                                                    "type": "array",
                                                    "items": {
                                                        "properties": {
                                                            "code": {
                                                                "type": "string",
                                                                "example": "asset"
                                                            },
                                                            "name": {
                                                                "type": "string",
                                                                "example": "Asset Management"
                                                            },
                                                            "url": {
                                                                "type": "string",
                                                                "example": "http://127.0.0.1:8000"
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                },
                                "example": {
                                    "token": "1|admin-kota-demo-token",
                                    "user": {
                                        "id": 1,
                                        "name": "Admin Kota",
                                        "email": "admin_kota@sso",
                                        "roles": [
                                            {
                                                "role": "admin_kota",
                                                "module": "asset_risk",
                                                "tenant_id": 1,
                                                "granted_at": "2025-11-15 00:00:00",
                                                "expires_at": null
                                            }
                                        ],
                                        "tenants": [
                                            {
                                                "tenant_id": 1,
                                                "nama": "Diskominfo Kota",
                                                "kode": "diskominfo"
                                            }
                                        ],
                                        "apps": [
                                            {
                                                "code": "asset",
                                                "name": "Asset Management",
                                                "url": "http://127.0.0.1:8000"
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "Invalid credentials."
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/v1/auth/logout": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Logout dan revoke token aktif",
                "operationId": "SsoMitraLogout",
                "responses": {
                    "200": {
                        "description": "Token revoked",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "logged out"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/me": {
            "get": {
                "tags": [
                    "Auth"
                ],
                "summary": "Profil user aktif + konteks",
                "operationId": "SsoMitraMe",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "id": 1,
                                    "name": "Admin Kota",
                                    "email": "admin_kota@sso",
                                    "roles": [
                                        {
                                            "role": "admin_kota",
                                            "module": "asset_risk",
                                            "tenant_id": 1
                                        }
                                    ],
                                    "tenants": [
                                        {
                                            "tenant_id": 1,
                                            "nama": "Diskominfo Kota",
                                            "kode": "diskominfo"
                                        }
                                    ],
                                    "apps": [
                                        {
                                            "code": "asset",
                                            "name": "Asset Management",
                                            "url": "http://127.0.0.1:8000"
                                        }
                                    ]
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/roles": {
            "get": {
                "tags": [
                    "Auth"
                ],
                "summary": "Daftar role user",
                "operationId": "SsoMitraRoles",
                "parameters": [
                    {
                        "name": "module",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "example": "asset_risk"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "roles": [
                                        {
                                            "role": "admin_kota",
                                            "module": "asset_risk",
                                            "tenant_id": 1
                                        }
                                    ]
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/refresh": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Informasi refresh token",
                "operationId": "SsoMitraRefresh",
                "responses": {
                    "200": {
                        "description": "Info",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "Use /auth/login to get a new token"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/profile": {
            "put": {
                "tags": [
                    "Auth"
                ],
                "summary": "Update profil user",
                "operationId": "SsoMitraUpdateProfile",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "John Doe Updated"
                                    },
                                    "nip": {
                                        "type": "string",
                                        "example": "199001012015011001",
                                        "nullable": true
                                    },
                                    "gender": {
                                        "type": "string",
                                        "example": "Laki-laki",
                                        "nullable": true
                                    },
                                    "unit_kerja": {
                                        "type": "string",
                                        "example": "Bidang TIK",
                                        "nullable": true
                                    },
                                    "asal_dinas": {
                                        "type": "string",
                                        "example": "Dinas Komunikasi dan Informatika",
                                        "nullable": true
                                    }
                                },
                                "type": "object"
                            },
                            "example": {
                                "name": "John Doe Updated",
                                "nip": "199001012015011001",
                                "gender": "Laki-laki",
                                "unit_kerja": "Bidang TIK",
                                "asal_dinas": "Dinas Komunikasi dan Informatika"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Profil berhasil diupdate",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "Profile updated successfully",
                                    "user": {
                                        "id": 1,
                                        "name": "John Doe Updated",
                                        "email": "admin_kota@sso",
                                        "profile": {
                                            "nip": "199001012015011001",
                                            "gender": "Laki-laki",
                                            "unit_kerja": "Bidang TIK",
                                            "asal_dinas": "Dinas Komunikasi dan Informatika"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/change-password": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Ubah password user",
                "operationId": "SsoMitraChangePassword",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "current_password",
                                    "new_password",
                                    "new_password_confirmation"
                                ],
                                "properties": {
                                    "current_password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "OldPassword123"
                                    },
                                    "new_password": {
                                        "type": "string",
                                        "format": "password",
                                        "minLength": 8,
                                        "example": "NewPassword123"
                                    },
                                    "new_password_confirmation": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "NewPassword123"
                                    }
                                },
                                "type": "object"
                            },
                            "example": {
                                "current_password": "OldPassword123",
                                "new_password": "NewPassword123",
                                "new_password_confirmation": "NewPassword123"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Password berhasil diubah",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "Password changed successfully"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Current password salah",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "Current password is incorrect"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation error",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "The new password confirmation does not match.",
                                    "errors": {
                                        "new_password": [
                                            "The new password confirmation does not match."
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/sso/authorize": {
            "get": {
                "tags": [
                    "SSO"
                ],
                "summary": "Get authorization code untuk client aplikasi (OAuth2 Authorization Code Grant)",
                "operationId": "SsoMitraSsoAuthorize",
                "parameters": [
                    {
                        "name": "client_id",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "siprima-app"
                        }
                    },
                    {
                        "name": "redirect_uri",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "http://127.0.0.1:8000/api/v1/auth/sso/callback"
                        }
                    },
                    {
                        "name": "state",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "state-demo-123"
                        }
                    },
                    {
                        "name": "response_type",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "example": "code"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Authorization code berhasil dibuat (valid 5 menit)",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "data": {
                                        "auth_code": "1e1c5e7c1c6d40b0bdb4b7f777281234",
                                        "state": "state-demo-123",
                                        "redirect_uri": "http://127.0.0.1:8000/api/v1/auth/sso/callback"
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid client_id / redirect_uri"
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/sso/token": {
            "post": {
                "tags": [
                    "SSO"
                ],
                "summary": "Tukar authorization code dengan access token (OAuth2 Token Exchange)",
                "operationId": "SsoMitraSsoToken",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "code",
                                    "client_id",
                                    "client_secret",
                                    "grant_type",
                                    "redirect_uri"
                                ],
                                "properties": {
                                    "code": {
                                        "type": "string",
                                        "example": "1e1c5e7c1c6d40b0bdb4b7f777281234"
                                    },
                                    "client_id": {
                                        "type": "string",
                                        "example": "siprima-app"
                                    },
                                    "client_secret": {
                                        "type": "string",
                                        "example": "supersecret123"
                                    },
                                    "grant_type": {
                                        "type": "string",
                                        "example": "authorization_code"
                                    },
                                    "redirect_uri": {
                                        "description": "Harus sama dengan redirect URI saat authorize",
                                        "type": "string",
                                        "example": "http://127.0.0.1:8000/api/v1/auth/sso/callback"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Access token berhasil dibuat",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "data": {
                                        "access_token": "2|external-token-demo",
                                        "token_type": "Bearer",
                                        "expires_in": 7200
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid client credential"
                    },
                    "401": {
                        "description": "Authorization code tidak valid / expired"
                    }
                }
            }
        },
        "/api/v1/auth/sso/userinfo": {
            "get": {
                "tags": [
                    "SSO"
                ],
                "summary": "Dapatkan informasi user dan roles (untuk keperluan callback client)",
                "operationId": "SsoMitraSsoUserinfo",
                "parameters": [
                    {
                        "name": "sso_token",
                        "in": "query",
                        "description": "Opsional: kirimkan token melalui query jika tidak bisa mengirim header Authorization (alias: token)",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User info berhasil diambil",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "id": 1,
                                    "username": "admin_kota@sso",
                                    "email": "admin_kota@sso",
                                    "name": "Admin Kota",
                                    "roles": [
                                        "admin_kota"
                                    ]
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "User belum login"
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/auth/sso/redirect": {
            "get": {
                "tags": [
                    "SSO"
                ],
                "summary": "Dapatkan URL redirect ke IdP (legacy - untuk client lain)",
                "operationId": "SsoMitraSsoRedirect",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "url": "https://idp.example.com/oauth/authorize?..."
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/v1/auth/sso/callback": {
            "get": {
                "tags": [
                    "SSO"
                ],
                "summary": "Callback dari IdP (legacy - untuk client lain)",
                "operationId": "SsoMitraSsoCallback",
                "parameters": [
                    {
                        "name": "code",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "demo-code"
                        }
                    },
                    {
                        "name": "state",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "example": "demo-state"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Berhasil autentikasi",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "token": "3|admin-kota-sso",
                                    "user": {
                                        "id": 1,
                                        "name": "Admin Kota",
                                        "email": "admin_kota@sso"
                                    },
                                    "provider": "default"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "State/Code invalid"
                    },
                    "401": {
                        "description": "Tidak bisa tukar authorization code"
                    }
                }
            }
        },
        "/api/v1/iam/roles": {
            "get": {
                "tags": [
                    "IAM"
                ],
                "summary": "Daftar role berdasarkan modul",
                "operationId": "SsoMitraIamRoles",
                "parameters": [
                    {
                        "name": "module",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "example": "asset_risk"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": [
                                    {
                                        "role_id": 1,
                                        "name": "admin_kota",
                                        "module": "asset_risk",
                                        "description": "Administrator Kota"
                                    }
                                ]
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/iam/assign-role": {
            "post": {
                "tags": [
                    "IAM"
                ],
                "summary": "Assign role ke user",
                "operationId": "SsoMitraIamAssign",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "user_id",
                                    "role",
                                    "tenant_id",
                                    "module"
                                ],
                                "properties": {
                                    "user_id": {
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "role": {
                                        "type": "string",
                                        "example": "admin_kota"
                                    },
                                    "tenant_id": {
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "module": {
                                        "type": "string",
                                        "example": "asset_risk"
                                    }
                                },
                                "type": "object"
                            },
                            "example": {
                                "user_id": 1,
                                "role": "admin_kota",
                                "tenant_id": 1,
                                "module": "asset_risk"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Role assigned",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "role assigned"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/iam/users/{id}/roles": {
            "get": {
                "tags": [
                    "IAM"
                ],
                "summary": "Daftar role user per tenant & module",
                "operationId": "SsoMitraIamUserRoles",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "example": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": [
                                    {
                                        "role": "admin_kota",
                                        "module": "asset_risk",
                                        "tenant_id": 1,
                                        "granted_at": "2025-11-15 00:00:00"
                                    }
                                ]
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/iam/revoke-role": {
            "post": {
                "tags": [
                    "IAM"
                ],
                "summary": "Revoke role dari user",
                "operationId": "SsoMitraIamRevoke",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "user_id",
                                    "role",
                                    "tenant_id",
                                    "module"
                                ],
                                "properties": {
                                    "user_id": {
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "role": {
                                        "type": "string",
                                        "example": "admin_kota"
                                    },
                                    "tenant_id": {
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "module": {
                                        "type": "string",
                                        "example": "asset_risk"
                                    }
                                },
                                "type": "object"
                            },
                            "example": {
                                "user_id": 1,
                                "role": "admin_kota",
                                "tenant_id": 1,
                                "module": "asset_risk"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Role revoked",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "role revoked"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/iam/audit-logs": {
            "get": {
                "tags": [
                    "IAM"
                ],
                "summary": "Audit log IAM terbaru",
                "operationId": "SsoMitraIamAuditLogs",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": [
                                    {
                                        "action": "assign-role",
                                        "user_id": 1,
                                        "role": "admin_kota",
                                        "tenant_id": 1,
                                        "performed_by": 1,
                                        "created_at": "2025-11-15 00:00:00"
                                    }
                                ]
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/staff/users": {
            "post": {
                "tags": [
                    "Staff"
                ],
                "summary": "Membuat akun user baru (hanya untuk role staff)",
                "operationId": "SsoMitraStaffCreateUser",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "name",
                                    "email",
                                    "password",
                                    "role"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "John Doe"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "john.doe@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "minLength": 8,
                                        "example": "SecurePass123"
                                    },
                                    "role": {
                                        "type": "string",
                                        "maxLength": 100,
                                        "example": "admin_opd"
                                    },
                                    "nip": {
                                        "type": "string",
                                        "maxLength": 100,
                                        "example": "199001012015011001",
                                        "nullable": true
                                    },
                                    "gender": {
                                        "type": "string",
                                        "maxLength": 50,
                                        "example": "Laki-laki",
                                        "nullable": true
                                    },
                                    "unit_kerja": {
                                        "type": "string",
                                        "maxLength": 255,
                                        "example": "Bidang TIK",
                                        "nullable": true
                                    },
                                    "asal_dinas": {
                                        "type": "string",
                                        "maxLength": 255,
                                        "example": "Dinas Komunikasi dan Informatika",
                                        "nullable": true
                                    }
                                },
                                "type": "object"
                            },
                            "example": {
                                "name": "John Doe",
                                "email": "john.doe@example.com",
                                "password": "SecurePass123",
                                "role": "admin_opd",
                                "nip": "199001012015011001",
                                "gender": "Laki-laki",
                                "unit_kerja": "Bidang TIK",
                                "asal_dinas": "Dinas Komunikasi dan Informatika"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Akun berhasil dibuat",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "message": {
                                            "type": "string",
                                            "example": "Akun baru berhasil dibuat."
                                        },
                                        "user": {
                                            "properties": {
                                                "id": {
                                                    "type": "integer",
                                                    "example": 2
                                                },
                                                "name": {
                                                    "type": "string",
                                                    "example": "John Doe"
                                                },
                                                "email": {
                                                    "type": "string",
                                                    "example": "john.doe@example.com"
                                                },
                                                "profile": {
                                                    "properties": {
                                                        "nip": {
                                                            "type": "string",
                                                            "example": "199001012015011001"
                                                        },
                                                        "gender": {
                                                            "type": "string",
                                                            "example": "Laki-laki"
                                                        },
                                                        "unit_kerja": {
                                                            "type": "string",
                                                            "example": "Bidang TIK"
                                                        },
                                                        "asal_dinas": {
                                                            "type": "string",
                                                            "example": "Dinas Komunikasi dan Informatika"
                                                        }
                                                    },
                                                    "type": "object"
                                                },
                                                "roles": {
                                                    "type": "array",
                                                    "items": {
                                                        "properties": {
                                                            "role": {
                                                                "type": "string",
                                                                "example": "admin_opd"
                                                            },
                                                            "module": {
                                                                "type": "string",
                                                                "example": "asset_risk"
                                                            },
                                                            "tenant_id": {
                                                                "type": "integer",
                                                                "example": 1
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - Hanya staff yang dapat menambahkan akun",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "Hanya staff yang dapat menambahkan akun."
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation error",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "message": "The email has already been taken.",
                                    "errors": {
                                        "email": [
                                            "The email has already been taken."
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/tenants": {
            "get": {
                "tags": [
                    "Tenant"
                ],
                "summary": "Daftar tenant milik user",
                "operationId": "SsoMitraTenantList",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": [
                                    {
                                        "tenant_id": 1,
                                        "nama": "Diskominfo Kota",
                                        "kode": "diskominfo"
                                    }
                                ]
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        },
        "/api/v1/tenants/{tenant}/switch": {
            "post": {
                "tags": [
                    "Tenant"
                ],
                "summary": "Switch tenant aktif",
                "operationId": "SsoMitraTenantSwitch",
                "parameters": [
                    {
                        "name": "tenant",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer",
                            "example": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Tenant switched",
                        "content": {
                            "application/json": {
                                "schema": {},
                                "example": {
                                    "active_tenant": {
                                        "tenant_id": 1,
                                        "nama": "Diskominfo Kota",
                                        "kode": "diskominfo"
                                    }
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "BearerAuth": []
                    }
                ]
            }
        }
    },
    "components": {
        "securitySchemes": {
            "BearerAuth": {
                "type": "http",
                "description": "Bearer token dari endpoint login lokal (untuk protected endpoints yang memerlukan auth), atau access token dari OAuth2 token endpoint",
                "bearerFormat": "Sanctum",
                "scheme": "bearer"
            }
        }
    },
    "tags": [
        {
            "name": "Auth V2",
            "description": "Authentication V2 - Simplified authentication endpoints"
        },
        {
            "name": "Auth",
            "description": "Autentikasi lokal - login, logout, profil, refresh token"
        },
        {
            "name": "SSO",
            "description": "OAuth2 Authorization Code Grant Flow - authorize, token exchange, userinfo (untuk aplikasi klien seperti SIPRIMA)"
        },
        {
            "name": "Tenant",
            "description": "Manajemen tenant/OPD - daftar dan switch tenant"
        },
        {
            "name": "IAM",
            "description": "IAM/RBAC - manajemen role dan permissions"
        },
        {
            "name": "App Picker",
            "description": "Daftar aplikasi yang bisa diakses user berdasarkan role"
        },
        {
            "name": "Staff",
            "description": "Manajemen user oleh staff - membuat akun user baru"
        }
    ]
}